Write-Output "Remove packages"

$bloatwarePackages = @(
    "Microsoft.ZuneMusic",
    "Microsoft.ZuneVideo",
    "Microsoft.BingNews",
    "Microsoft.BingWeather",
    "Microsoft.BingFinance",
    "Microsoft.BingSports",
    "Microsoft.SkypeApp",
    "Microsoft.XboxApp",
    "Microsoft.XboxGameCallableUI",
    "Microsoft.XboxIdentityProvider",
    "Microsoft.MinecraftUWP",
    "Microsoft.People",
    "Microsoft.3DBuilder",
    "Microsoft.GetHelp",
    "Microsoft.Getstarted",
    "Microsoft.YourPhone",
    "Microsoft.Office.OneNote",
    "Microsoft.MicrosoftOfficeHub",
    "Microsoft.WindowsFeedbackHub",
    "Microsoft.MicrosoftSolitaireCollection",
    "Microsoft.MixedReality.Portal",
    "Microsoft.Office.Sway",
    "Microsoft.OneConnect",
    "Microsoft.Print3D",
    "Microsoft.StickyNotes",
    "Microsoft.Wallet",
    "Microsoft.Windows.Photos",
    "Microsoft.WindowsAlarms",
    "Microsoft.WindowsCamera",
    "Microsoft.WindowsMaps",
    "Microsoft.WindowsSoundRecorder",
    "Microsoft.WindowsFeedbackHub",
    "Microsoft.WindowsMixedReality",
    "Microsoft.Xbox.TCUI",
    "Microsoft.XboxApp",
    "Microsoft.XboxGameOverlay",
    "Microsoft.XboxGamingOverlay",
    "Microsoft.XboxIdentityProvider",
    "Microsoft.XboxSpeechToTextOverlay",
    "Microsoft.MicrosoftStickyNotes",
    "Microsoft.HEIFImageExtension",
    "Microsoft.ScreenSketch"
)

# Function to remove bloatware packages
function Remove-Bloatware {
    param (
        [string[]]$packages
    )

    foreach ($package in $packages) {
        $appxPackage = Get-AppxPackage -Name $package -ErrorAction SilentlyContinue
        if ($null -ne $appxPackage) {
            Remove-AppxPackage -Package $appxPackage.PackageFullName
        }
    }
}

# Remove bloatware packages
Remove-Bloatware -packages $bloatwarePackages

# Remove bloatware packages for all users
foreach ($package in $bloatwarePackages) {
    $appxPackage = Get-AppxPackage -AllUsers -Name $package -ErrorAction SilentlyContinue
    if ($null -ne $appxPackage) {
        Remove-AppxPackage -Package $appxPackage.PackageFullName -AllUsers
    }
}
